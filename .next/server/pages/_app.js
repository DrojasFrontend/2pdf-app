(()=>{var e={};e.id=888,e.ids=[888],e.modules={5314:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});var a=t(997),i=t(6689),n=t(1163);function s({children:e}){let[r,t]=(0,i.useState)(!0),[s,o]=(0,i.useState)(!1);return((0,n.useRouter)(),r)?a.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",backgroundColor:"#0d1117",color:"#c9d1d9"},children:a.jsx("div",{children:"Cargando..."})}):s?a.jsx(a.Fragment,{children:e}):null}t(9797)},1866:(e,r,t)=>{"use strict";t.d(r,{Z:()=>o});var a=t(997),i=t(6689),n=t(1163),s=t(8887);function o({children:e}){let r=(0,n.useRouter)(),{loading:t,needsOrganization:o}=(0,s.o)(),[l,d]=(0,i.useState)(!1);return!l||t?a.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",backgroundColor:"#0d1117",color:"#c9d1d9"},children:a.jsx("div",{children:"Cargando..."})}):o&&"/create-organization"!==r.pathname?null:a.jsx(a.Fragment,{children:e})}},7368:()=>{},7183:()=>{},2885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},2048:e=>{"use strict";e.exports=require("fs")},6162:e=>{"use strict";e.exports=require("stream")},1568:e=>{"use strict";e.exports=require("zlib")},9752:e=>{"use strict";e.exports=import("@tanstack/react-query")},8887:(e,r,t)=>{"use strict";t.d(r,{o:()=>n});var a=t(6689),i=t(4805);function n(){let[e,r]=(0,a.useState)(!0),[t,n]=(0,a.useState)(!1),[s,o]=(0,a.useState)(null),[l,d]=(0,a.useState)(null),c=async()=>{try{r(!0),d(null);let e=await (0,i.r1)();n(e.needsOrganization),o(e.organizationId)}catch(e){d(e.message),console.error("Error checking organization:",e)}finally{r(!1)}};return{loading:e,needsOrganization:t,organizationId:s,error:l,createOrganization:async({name:e,slug:t})=>{try{r(!0),d(null);let a=await (0,i.Yi)({name:e,slug:t});return await c(),a}catch(e){throw d(e.message),e}finally{r(!1)}},refresh:c}}},9797:(e,r,t)=>{"use strict";t.d(r,{O:()=>s});var a=t(2885);let i="https://cvinihbkfvnxvtihozxp.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2aW5paGJrZnZueHZ0aWhvenhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzQ2MTIsImV4cCI6MjA3OTg1MDYxMn0.7lnRCVfXaciTOLQn90lzLIQq1F9aNBD_bXHjFjW2Y-Q";if(!i||!n)throw Error("Missing Supabase environment variables");let s=(0,a.createClient)(i,n)},4805:(e,r,t)=>{"use strict";t.d(r,{$z:()=>l,Mn:()=>s,Wr:()=>o,Yi:()=>n,r1:()=>i,t4:()=>d});var a=t(9797);async function i(){try{let{data:{user:e},error:r}=await a.O.auth.getUser();if(r||!e)throw Error("Usuario no autenticado");let{data:t,error:i}=await a.O.from("app_users").select("id").eq("auth_user_id",e.id).single();if(i||!t){console.log("App user no encontrado, intentando crear...");let{data:r,error:i}=await a.O.from("app_users").insert({auth_user_id:e.id,display_name:e.user_metadata?.display_name||e.user_metadata?.full_name||e.email?.split("@")[0]||"Usuario"}).select("id").single();if(i||!r)throw Error(`Error creando usuario en app_users: ${i?.message||"Error desconocido"}`);t=r;let n=e.user_metadata?.invited_organization_id;if(n){let{error:e}=await a.O.from("organization_memberships").insert({organization_id:n,user_id:t.id,role:"developer"});if(!e)return await a.O.auth.updateUser({data:{invited_organization_id:null}}),{appUserId:t.id,organizationId:n,needsOrganization:!1}}}let{data:n,error:s}=await a.O.from("organization_memberships").select("organization_id").eq("user_id",t.id).limit(1).single();if(s||!n)return{appUserId:t.id,organizationId:null,needsOrganization:!0};return{appUserId:t.id,organizationId:n.organization_id,needsOrganization:!1}}catch(e){throw console.error("Error getting user context:",e),e}}async function n({name:e,slug:r}){try{let t=await i();if(!t.appUserId)throw Error("Usuario no autenticado");let{appUserId:n}=t,{data:s,error:o}=await a.O.from("organizations").insert({name:e,slug:r||e.toLowerCase().replace(/\s+/g,"-"),created_by:n}).select().single();if(o)throw Error(`Error creando organizaci\xf3n: ${o.message}`);let{data:l,error:d}=await a.O.from("organization_memberships").insert({organization_id:s.id,user_id:n,role:"owner"}).select().single();if(d)throw await a.O.from("organizations").delete().eq("id",s.id),Error(`Error creando membership: ${d.message}`);return{organization:s,membership:l}}catch(e){throw console.error("Error creating organization:",e),e}}async function s({name:e,description:r,html:t,css:n,data:s}){try{let o=await i();if(o.needsOrganization)throw Error("Usuario necesita crear una organizaci\xf3n primero");let{appUserId:l,organizationId:d}=o,{data:c,error:u}=await a.O.from("templates").insert({organization_id:d,name:e,description:r||null,created_by:l}).select().single();if(u)throw Error(`Error creando template: ${u.message}`);let{data:m,error:p}=await a.O.from("template_versions").insert({template_id:c.id,version_label:"v1.0.0",major:1,minor:0,patch:0,html:t,css:n,data_schema:s?JSON.parse(s):null,is_active:!0,is_default:!0,created_by:l}).select().single();if(p)throw await a.O.from("templates").delete().eq("id",c.id),Error(`Error creando versi\xf3n: ${p.message}`);return{template:c,version:m}}catch(e){throw console.error("Error creating template:",e),e}}async function o(e,{html:r,css:t,data:n,notes:s}){try{let o=await i();if(o.needsOrganization)throw Error("Usuario necesita crear una organizaci\xf3n primero");let{appUserId:l}=o,{data:d}=await a.O.from("template_versions").select("major, minor, patch").eq("template_id",e).order("created_at",{ascending:!1}).limit(1).single(),c=1,u=0,m=0,p="v1.0.0";d&&(c=d.major,u=d.minor,m=d.patch+1,p=`v${c}.${u}.${m}`),await a.O.from("template_versions").update({is_default:!1}).eq("template_id",e);let{data:g,error:h}=await a.O.from("template_versions").insert({template_id:e,version_label:p,major:c,minor:u,patch:m,html:r,css:t,data_schema:n?JSON.parse(n):null,is_active:!0,is_default:!0,notes:s||null,created_by:l}).select().single();if(h)throw Error(`Error creando versi\xf3n: ${h.message}`);return g}catch(e){throw console.error("Error creating template version:",e),e}}async function l(){try{let e=await i();if(e.needsOrganization)return[];let{organizationId:r}=e,{data:t,error:n}=await a.O.from("templates").select(`
        id,
        name,
        description,
        template_type,
        is_archived,
        created_at,
        template_versions!inner (
          id,
          version_label,
          is_default,
          created_at
        )
      `).eq("organization_id",r).eq("is_archived",!1).order("created_at",{ascending:!1});if(n)throw Error(`Error obteniendo templates: ${n.message}`);return t.map(e=>({id:e.id,name:e.name,description:e.description,template_type:e.template_type,created_at:e.created_at,version:e.template_versions?.[0]||null}))}catch(e){throw console.error("Error getting user templates:",e),e}}async function d(e){try{let{data:r,error:t}=await a.O.from("templates").select("*").eq("id",e).single();if(t)throw Error(`Error obteniendo template: ${t.message}`);let{data:i,error:n}=await a.O.from("template_versions").select("*").eq("template_id",e).eq("is_default",!0).single();if(n)throw Error(`Error obteniendo versi\xf3n: ${n.message}`);return{...r,version:{...i,data:i.data_schema?JSON.stringify(i.data_schema,null,2):"{}"}}}catch(e){throw console.error("Error getting template:",e),e}}},7984:(e,r,t)=>{"use strict";t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>u});var i=t(997);t(7368),t(7183);var n=t(9752),s=t(6689),o=t(1163),l=t(5314),d=t(1866),c=e([n]);function u({Component:e,pageProps:r}){let[t]=(0,s.useState)(()=>new n.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}})),a=(0,o.useRouter)(),c="/login"===a.pathname;return i.jsx(n.QueryClientProvider,{client:t,children:c?i.jsx(e,{...r}):i.jsx(l.Z,{children:i.jsx(d.Z,{children:i.jsx(e,{...r})})})})}n=(c.then?(await c)():c)[0],a()}catch(e){a(e)}})}};var r=require("../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[567,163],()=>t(7984));module.exports=a})();